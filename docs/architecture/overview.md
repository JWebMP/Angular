## Architecture overview (evidence-based)

- Purpose: Generate Angular 20 source/config from JWebMP annotations and host an externally built dist via Vert.x 5 with STOMP/WebSocket messaging. Angular bundling/build is expected to run outside this module.
- Entry points: Guice lifecycle (`AngularPreStartup`, `AngularTSPostStartup`) and Vert.x router binding (`AngularTSSiteBinder`).
- Runtime flow:
  - Pre-startup sets `BIND_JW_PAGES=false` to avoid conflicting bindings.
  - Post-startup checks `JWEBMP_PROCESS_ANGULAR_TS`/`jwebmp.process.angular.ts`; if enabled, `JWebMPTypeScriptCompiler` scans `@NgApp`/`@NgComponent`/`@NgRoutable` and writes TS/Angular config plus assets.
  - Component import/configuration: `ConfigureImportReferences` (`IOnComponentConfigured`, registered in `META-INF/services/com.jwebmp.core.databind.IOnComponentConfigured`) rewrites JWebMP component trees into Angular tags/imports/inputs/outputs and stores `AngularConfiguration` metadata used when generating HTML/CSS/index content.
  - `AngularTSSiteBinder` binds Guice module, calculates dist paths via `AppUtils`, serves static assets from an existing dist (including /assets), real-file handling + SPA fallback, and configures a Vert.x STOMP bridge at `/eventbus` with event-bus consumer dispatch to registered listeners.
  - Server–client messaging uses STOMP over WebSocket: clients connect to `/eventbus`, send to `/toBus/incoming`, and receive from `/toStomp.*`; payloads are converted to `WebSocketMessageReceiver`, routed to `IGuicedWebSocket` listeners, and replied with `AjaxResponse` data, session/local storage updates, or published `DynamicData`.
  - npm configuration: `NpmrcConfigurator` SPI (declared in `module-info.java`) can be supplied to adjust `.npmrc` content during TypeScript/Angular generation.
- Planned change: `JWebMPTypeScriptCompiler` is marked for deprecation; new work should target `TypeScriptCompiler` while maintaining compatibility during migration.

## Dependencies & integrations

- Internal: JWebMP Core + TypeScript client annotations; GuicedEE scanning; Lombok `@Log4j2`; Apache Commons IO/Text; ClassGraph; Jackson.
- External runtime: Vert.x 5 (HTTP server, event bus, STOMP bridge); Guice DI; Angular 20 runtime in generated dist.
- Build: Maven (Java 25 LTS); flatten-maven-plugin configured; moditect ignored via property.
- Tests: JUnit Jupiter present; TypeScript/Angular compilation not exercised in tests.

## Trust boundaries / threat sketch

- WebSocket/STOMP endpoint `/eventbus` accepts client payloads and forwards them to Vert.x event bus; message listeners must validate `action` and payload to avoid abuse.
- Static hosting serves files from generated dist path; ensure dist path resolution does not expose unintended directories.
- Heartbeats configured (server → client every 10s; client heartbeats disabled) — monitor for idle connections and DOS exposure.
- No authentication/authorization wiring is evident for STOMP/websockets; consumers must enforce access control at listener layer.
- TS generation writes to file system under user directory (`webroot`/`dist`); ensure permissions and clean-up policies are documented.

## Glossary composition plan (topic-first)

- Root `GLOSSARY.md` will act as an index; topic glossaries from the rules submodule take precedence.
- Topics to include: Java 25, Maven, Angular 20, JWebMP Core/Client/TypeScript, GuicedEE (Core/Client/Web/WebSocket), Vert.x 5, Lombok (CRTP fluent style), Log4j2, Jacoco, GitHub Actions.
- Prompt Language Alignment mappings to duplicate locally: CRTP fluent setter guidance, Log4j2 usage, Angular terminology (Routes, Components, Modules), WebAwesome terms only if plugin selected (not selected here).

## Open questions / unknowns

- No explicit auth/session model for WebSocket/STOMP; confirm intended security layer.
- Dist path expectations for multi-`@NgApp` scenarios (currently uses `AppUtils` base path).
- Browser build toolchain details (npm scripts/versions) generated by compiler are not visible in repo artifacts; confirm desired pinning.*** End Patch to=functions.apply_patch debug♀♀♀♀ Json## Test Output Reasoning
